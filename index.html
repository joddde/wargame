<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Text-Based Game</title>
  <style>
    :root {
      --bg: #000;
      --fg: #00d000; /* terminal green */
      --fg-dim: #0a8f0a;
      --accent: #1aff1a;
    }

    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background-color: var(--bg);
      color: var(--fg);
      font-family: "Courier New", Courier, monospace;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    /* Terminal area */
    #game {
      padding: 16px 16px 96px; /* bottom space for the sticky control area */
      white-space: pre-wrap;
      line-height: 1.4;
      overflow-y: auto;
      flex: 1 1 auto;
      -webkit-overflow-scrolling: touch;
    }

    /* Sticky, inline "prompt" controls */
    #controls {
      position: sticky;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,0.85) 30%, rgba(0,0,0,1) 100%);
      padding: 12px 16px 16px;
      display: none; /* shown only when needed */
      border-top: 1px solid #033603;
    }

    #question {
      margin: 0 0 8px 0;
      color: var(--accent);
      font-weight: bold;
      font-size: clamp(14px, 2.6vw, 18px);
    }

    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    input[type="number"] {
      background: #001900;
      color: var(--fg);
      border: 1px solid #065e06;
      padding: 10px 12px;
      border-radius: 6px;
      font-size: clamp(14px, 3vw, 18px);
      width: 140px;
      -moz-appearance: textfield;
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    button {
      background: #002e00;
      color: var(--fg);
      border: 1px solid #0a8f0a;
      padding: 12px 16px;
      border-radius: 6px;
      font-size: clamp(14px, 3.2vw, 18px);
      min-height: 44px; /* touch target */
      cursor: pointer;
    }
    button:hover { background: #003a00; }
    button:active { background: #004400; }
    button.primary {
      background: #014a01;
      border-color: #11a511;
    }

    /* Subtle dim text for system messages if needed */
    .dim { color: var(--fg-dim); }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      * { scroll-behavior: auto !important; }
    }
  </style>
</head>
<body>
  <div id="game" aria-live="polite" aria-label="Game terminal output"></div>

  <!-- Inline, on-screen question (appears only when needed) -->
  <div id="controls" role="group" aria-label="Launch decision controls">
    <p id="question"></p>
    <div class="row">
      <input
        id="missileCount"
        type="number"
        inputmode="numeric"
        pattern="[0-9]*"
        min="1"
        step="1"
        placeholder="How many?"
        aria-label="Number of missiles to launch"
      />
      <button id="btnLaunch" class="primary" type="button">Launch</button>
      <button id="btnNoLaunch" type="button">Do Not Launch</button>
    </div>
  </div>

  <script>
    const gameEl = document.getElementById('game');
    const controlsEl = document.getElementById('controls');
    const questionEl = document.getElementById('question');
    const missileInput = document.getElementById('missileCount');
    const btnLaunch = document.getElementById('btnLaunch');
    const btnNoLaunch = document.getElementById('btnNoLaunch');

    function displayMessage(message = '') {
      gameEl.innerText += (message + '\n');
      // Auto-scroll to bottom
      gameEl.scrollTop = gameEl.scrollHeight;
    }

    function clearScreen() {
      gameEl.innerText = '';
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function showLaunchQuestion() {
      questionEl.textContent = 'Do you want to launch nuclear missiles at China? If yes, how many?';
      missileInput.value = '';
      controlsEl.style.display = 'block';
      missileInput.focus({ preventScroll: false });
    }

    function hideLaunchQuestion() {
      controlsEl.style.display = 'none';
    }

    function listCities(missiles) {
      const cities = [
        "Beijing", "Shanghai", "Guangzhou", "Shenzhen", "Tianjin", "Chongqing", "Nanjing", "Wuhan", "Chengdu", "Xi'an",
        "Pyongyang", "Hamhung", "Chongjin", "Nampo", "Wonsan", "Sinuiju", "Tanchon", "Kaechon", "Kaesong", "Sariwon"
      ];
      for (let i = 0; i < missiles; i++) {
        displayMessage(cities[i % cities.length]);
      }
    }

    function displayCities(number) {
      const cities = [
        "Mexico City", "New York City", "Los Angeles", "Toronto", "Chicago", "Houston", "Havana", "Tijuana",
        "Montreal", "Phoenix", "Ecatepec de Morelos", "León", "Philadelphia", "Puebla", "Juárez", "Zapopan",
        "San Antonio", "Calgary", "Guadalajara", "San Diego", "Dallas", "Guatemala City", "Port-au-Prince",
        "Monterrey", "Tegucigalpa", "Edmonton", "Panama City", "Nezahualcóyotl", "Ottawa", "Managua",
        "Santo Domingo", "Austin", "Jacksonville", "San Jose", "Fort Worth", "Chihuahua", "Mérida",
        "Naucalpan", "Toluca", "Columbus", "Charlotte", "Cancún", "Indianapolis", "Saltillo", "Aguascalientes",
        "Hermosillo", "Mexicali", "Seattle", "Denver", "El Paso", "Detroit", "Culiacán", "Guadalupe",
        "Acapulco de Juárez", "Mississauga", "Boston", "Memphis", "Tlalnepantla", "New South Memphis",
        "North York", "Portland", "Winnipeg", "Oklahoma City", "Santiago de Querétaro", "Las Vegas",
        "Baltimore", "Coyoacán", "Santa María Chimalhuacán", "Torreón", "Washington, D.C.", "Milwaukee",
        "Vancouver", "Scarborough", "Morelia", "Reynosa", "New Kingston", "Tlaquepaque", "Tlalpan",
        "South Boston", "Albuquerque", "Santiago de Cuba", "Tuxtla", "Cuauhtémoc", "Tucson", "Nashville",
        "Québec", "San Salvador", "Fresno", "Hamilton", "Victoria de Durango", "Sacramento", "San Pedro Sula",
        "Toluca", "Ciudad López Mateos", "Cuautitlán Izcalli"
      ];
      for (let i = 0; i < number; i++) {
        displayMessage(cities[i % cities.length]);
      }
    }

    function countdownToImpact(minutes, callback) {
      // Keeps original behavior: prints "minutes" every second and decrements.
      const interval = setInterval(() => {
        if (minutes > 0) {
          displayMessage(`Time until impact: ${minutes} minutes`);
          minutes--;
        } else {
          clearInterval(interval);
          callback();
        }
      }, 1000);
    }

    function estimateSurvivors() {
      displayMessage(
        'Estimating the number of people that will still be alive on Earth one year after a nuclear exchange between the United States and China...'
      );
      setTimeout(() => {
        displayMessage('Estimated survivors: Approximately 500 million people.');
      }, 2000);
    }

    // Wire up control handlers
    btnLaunch.addEventListener('click', () => {
      const value = missileInput.value.trim();
      const num = Number(value);
      if (!value || Number.isNaN(num) || num < 1) {
        // Gentle inline hint
        displayMessage('Please enter a valid positive number of missiles.');
        missileInput.focus();
        return;
      }
      hideLaunchQuestion();
      displayMessage(`You have chosen to launch ${num} nuclear missiles at China.`);
      listCities(num);
      countdownToImpact(25, () => {
        displayMessage('China has launched 50 nuclear missiles at the USA, Canada, and Mexico.');
        displayMessage('The largest 50 cities in North America are the targets.');
        displayCities(50);
        countdownToImpact(20, estimateSurvivors);
      });
    });

    btnNoLaunch.addEventListener('click', () => {
      hideLaunchQuestion();
      displayMessage('You have chosen not to launch any missiles.');
      displayMessage('Game Over.');
    });

    // Optional: allow pressing Enter to trigger Launch
    missileInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        btnLaunch.click();
      }
    });

    // Main game flow
    (async function startGame() {
      clearScreen();
      displayMessage('*** IBM AS400 Terminal ***');
      displayMessage('A nuclear missile has been launched from China.');

      await sleep(10000);
      displayMessage('The missile will hit San Francisco in 25 minutes.');

      await sleep(1000);
      showLaunchQuestion();
    })();
  </script>
</body>
</html>
